# 博客展示站 PRD（Nextcloud WebDAV 构建期内容源）

## 1. 背景与目标

### 1.1 背景

- 内容与资源存储在 Nextcloud 中，站点不自建数据库与后台。
- 构建阶段通过 WebDAV 以只读方式拉取 Markdown 与附件，生成静态页面后对外展示。

### 1.2 产品目标（MVP）

- 提供一个“只读展示”的博客站点：文章列表、文章详情、标签/分类浏览、基础搜索。
- 保持部署简单：静态资源部署即可运行（无服务端写接口、无后台管理）。

### 1.3 非目标（本版不做）

- 站内编辑、保存草稿、发布/撤回、上传图片/附件、内容写入与移动。
- 站内账号体系与登录（访客侧不需要认证流程）。
- 评论系统与统计系统（仅作为后续迭代记录）。

## 2. 角色与使用场景

### 2.1 角色

- 访客：浏览、检索、阅读文章。
- 内容维护者（站外流程）：在 Nextcloud 中直接维护 Markdown 与资源文件；站点不提供维护入口。

### 2.2 典型场景

- 访客阅读：打开首页 -> 浏览列表 -> 进入详情 -> 通过目录（TOC）跳转阅读。
- 访客检索：按标签/分类筛选 -> 或输入关键字搜索 -> 打开结果文章。
- 内容更新（站外）：维护者在 Nextcloud 更新文件 -> 触发一次重新构建与发布 -> 站点展示最新内容。

## 3. 产品范围（MVP）

### 3.1 内容接入（只读）

- 内容源：Nextcloud WebDAV 下的博客根目录。
- 访问方式：站点运行时无需用户输入凭证；WebDAV 凭证仅用于构建环境（本地或 CI），不进入浏览器端产物。
- WebDAV 能力：仅依赖 `PROPFIND`（列目录/元信息）与 `GET`（读取文件）。
- 站点不执行任何写操作：不使用 `PUT`/`DELETE`/`MOVE`/`COPY`。

### 3.2 页面与功能

- 首页/列表页：
  - 按时间倒序展示文章卡片（标题、摘要、封面、标签/分类、日期）。
  - 支持分页。
- 文章详情页：
  - Markdown 渲染（含标题锚点、目录 TOC）。
  - 代码高亮、图片懒加载、站内链接解析。
  - 支持封面图展示（如存在）。
- 标签/分类页：按标签或分类聚合文章并支持进一步筛选。
- 搜索：
  - MVP：在已加载的元数据字段中搜索（标题/摘要/标签/分类）。
  - 不要求全文搜索。
- 通用页面：
  - 404 与空态页（无文章/无结果）。
  - 关于页（静态内容）。

### 3.3 状态与错误反馈

- 加载态：列表与详情页提供 skeleton 或占位加载。
- 错误态：文章不存在、无结果、渲染失败需给出明确提示与返回入口；WebDAV 不可达/权限不足属于构建失败原因，不应在运行时暴露为用户错误页。

## 4. 信息架构与数据模型

### 4.1 WebDAV 目录约定

- 博客根目录（示例）：`/remote.php/dav/files/{username}/blog/`
- 目录：
  - `posts/`：Nextcloud 中的文章目录（站点只读展示的唯一文章来源，构建时下载到本地 `content/` 目录）
  - `assets/`：图片与附件目录

### 4.2 文件命名与路由

- 文章文件名：`yyyy-mm-dd--slug.md`
- 路由：
  - `slug` 为详情页唯一标识，要求全站唯一。
  - 日期用于排序展示（优先取 Front Matter 的 `createdAt`，否则使用文件名日期）。

### 4.3 Front Matter 字段

- 必填：
  - `title`: string
  - `slug`: string（与文件名中的 `slug` 一致）
  - `createdAt`: ISO string
- 选填：
  - `updatedAt`: ISO string
  - `summary`: string
  - `tags`: string[]
  - `category`: string
  - `cover`: string（相对路径，指向 `assets/`）

### 4.4 资源引用规则

- Markdown 内图片与附件引用使用相对路径，并以博客根目录为基准（例如 `assets/2025/01/a.png`），站点渲染时解析为可访问的资源 URL。

## 5. 核心用户故事与验收标准（MVP）

### 5.1 浏览列表

- 访客打开首页能在 2s 内看到文章列表（网络正常、50 篇文章以内）。
- 列表展示信息来自 Front Matter 与文件名日期；字段缺失不阻塞渲染（例如无 `cover` 则不展示封面区域，无 `summary` 则不展示摘要区域）。

### 5.2 阅读详情

- 访客点击任意文章可进入详情页并正确渲染 Markdown。
- 目录（TOC）点击可跳转到对应段落锚点。
- 代码块具备可读的高亮样式；图片加载失败时展示 alt 文本与错误提示。

### 5.3 标签/分类与搜索

- 访客可在标签/分类页筛选文章并能进入详情页。
- 访客输入关键字可在元数据字段内返回匹配文章，并展示无结果空态。

## 6. 非功能需求

- 性能：在 50 篇文章以内，首屏列表渲染 < 2s（网络正常）；详情页首屏内容渲染 < 2s（网络正常）。
- 兼容：Chrome/Edge/Safari/Firefox 最新两个大版本；移动端阅读适配。
- 可访问性：语义化标题层级、可键盘导航、图片具备 `alt` 文本。
- 安全：
  - 站点不持有可写凭证，不提供写入能力。
  - 如使用公开可读内容源，视为公开信息，不在页面或日志输出任何敏感令牌。
- 稳定性：构建失败不影响已发布版本的可访问性；运行时静态资源加载失败时提供清晰错误与返回入口，避免白屏。

## 7. 体验与界面基调

- 视觉：阅读优先、排版清晰、代码块与引用块可读。
- 导航：顶部导航（主页/标签/分类/关于）；文章页提供侧边 TOC（桌面端）。
- 反馈：加载 skeleton、错误 inline 提示、空态清晰文案。

## 8. 技术与部署约束（需求层面）

- 纯前端运行时：部署产物为静态资源（HTML/CSS/JS），运行时不依赖自建服务端 API 或 WebDAV。
- 构建期拉取：构建流程需要访问 WebDAV 并生成静态产物（页面与索引）。
- WebDAV：仅使用 `PROPFIND` 与 `GET`。
- 网络约束：构建环境需可访问 Nextcloud；构建期不受浏览器 CORS 限制。

## 9. 里程碑（建议）

- M0：确认内容源访问方式、目录结构、路由规则、SEO 预期。
- M1：WebDAV 只读拉取；文章列表与详情渲染；基础错误态。
- M2：标签/分类页与元数据搜索；UI 细节与移动端适配。

## 10. 依赖、风险与对策

- 构建依赖：Nextcloud 不可用或凭证失效会导致构建失败；对策是在 M0 明确凭证管理方式与构建失败处理策略。
- 发布延迟：内容更新到站点生效依赖重新构建与发布；对策是明确触发机制与更新频率。
- 性能退化：文章数量增大时，构建期逐篇拉取解析会增加构建耗时；对策是引入内容索引文件或增量构建策略（列入后续迭代/待确认）。

## 11. 后续迭代（记录）

- RSS 与 `sitemap.xml` 输出。
- 全文搜索索引（构建期生成）。
- 评论集成（Giscus/Disqus 等第三方）。
- 暗色模式与排版主题定制。

## 12. 待确认（M0 输出）

- 构建触发：手动触发（执行 `npm run build` 生成 `dist/`），详见 `docs/plan/M0/M0-T1-01-build-and-release.md`。
- 资源策略：构建产物是否需要同步 `assets/` 到站点同源；或允许文章引用 Nextcloud 资源直链。
- SEO 目标：是否要求文章详情页静态化（默认满足）；是否需要 `sitemap.xml` 与 RSS（后续迭代中已记录）。
